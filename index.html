<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>بروتوكولات التأمين</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&family=Readex+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
:root {
    --font-heading: 'Readex Pro', 'Cairo', sans-serif;
    --font-body: 'Cairo', sans-serif;
    
    --radius-sm: 0.7rem;
    --radius-md: 1.2rem;
    --radius-lg: 1.8rem;
    --radius-xl: 2.8rem;
    --radius-pill: 50rem;

    --spacing-unit: 1rem;
    --container-width: 1280px;

    --transition-fast: all 0.2s ease-in-out;
    --transition-smooth: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-elastic: all 0.55s cubic-bezier(0.68, -0.6, 0.32, 1.6);
}

html[data-theme="light"] {
    --color-primary: #007A7A; /* Refined Teal */
    --color-primary-rgb: 0, 122, 122;
    --color-secondary: #00A3A3; /* Brighter Teal */
    --color-secondary-rgb: 0, 163, 163;
    --color-accent: #B2DFDB; /* Light Teal Tint */
    --color-accent-rgb: 178, 223, 219;
    --color-highlight: #FFB300; /* Warm Gold/Amber */
    --color-highlight-rgb: 255, 179, 0;
    --color-highlight-alt: #E69500; /* Darker Gold */

    --color-background: #FDFDFD; /* Cleaner Off-white */
    --color-background-rgb: 253, 253, 253;
    --color-surface: #FFFFFF;
    --color-surface-alt: #F0F4F8; /* Softer alt surface */
    
    --color-text-base: #2C3E50; /* Dark Slate Blue */
    --color-text-muted: #7F8C8D; /* Muted Grayish Cyan */
    --color-text-subtle: #ABB7B7; /* Lighter Grayish Cyan */
    --color-text-on-primary: #FFFFFF;
    --color-border: #DDE2E6; /* Lighter, softer border */
    --color-border-light: #E8ECF0;

    --shadow-xs: 0 1px 2px rgba(var(--color-primary-rgb), 0.05);
    --shadow-sm: 0 2px 5px rgba(var(--color-primary-rgb), 0.07);
    --shadow-md: 0 5px 12px rgba(var(--color-primary-rgb), 0.08), 0 1px 3px rgba(var(--color-primary-rgb), 0.06);
    --shadow-lg: 0 12px 25px rgba(var(--color-primary-rgb), 0.09), 0 3px 8px rgba(var(--color-primary-rgb), 0.07);
    
    --mark-bg: rgba(var(--color-highlight-rgb), 0.15);
    --mark-color: var(--color-highlight-alt);

    --page-num-gradient-card: linear-gradient(135deg, var(--color-highlight) 0%, var(--color-secondary) 100%);
    --page-num-gradient-list: linear-gradient(to right, var(--color-secondary), var(--color-primary));
}

html[data-theme="dark"] {
    --color-primary: #66D9EF; 
    --color-primary-rgb: 102, 217, 239;
    --color-secondary: #A1E8F4; 
    --color-secondary-rgb: 161, 232, 244;
    --color-accent: #2E3A47; 
    --color-accent-rgb: 46, 58, 71;
    --color-highlight: #FFD700; 
    --color-highlight-rgb: 255, 215, 0;
    --color-highlight-alt: #E6B800;

    --color-background: #1A1D24; 
    --color-background-rgb: 26, 29, 36;
    --color-surface: #242830; 
    --color-surface-alt: #2E333D; 
    
    --color-text-base: #EAEAEA; 
    --color-text-muted: #A0A7B0; 
    --color-text-subtle: #78808A; 
    --color-text-on-primary: #111827; 
    --color-border: #383D4A; 
    --color-border-light: #4A505E;

    --shadow-xs: 0 1px 2px rgba(0,0,0, 0.2);
    --shadow-sm: 0 2px 4px rgba(0,0,0, 0.25);
    --shadow-md: 0 4px 10px rgba(0,0,0, 0.3), 0 1px 3px rgba(0,0,0, 0.25);
    --shadow-lg: 0 10px 20px rgba(0,0,0, 0.35), 0 3px 6px rgba(0,0,0, 0.3);

    --mark-bg: rgba(var(--color-highlight-rgb), 0.25);
    --mark-color: var(--color-highlight);
    
    --page-num-gradient-card: linear-gradient(135deg, var(--color-highlight) 0%, var(--color-primary) 100%);
    --page-num-gradient-list: linear-gradient(to right, var(--color-primary), var(--color-accent));
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 62.5%; scroll-behavior: smooth; height: 100%; }

body {
    font-family: var(--font-body);
    line-height: 1.75;
    background-color: var(--color-background);
    color: var(--color-text-base);
    font-size: 1.7rem; 
    font-weight: 400;
    transition: background-color var(--transition-smooth), color var(--transition-smooth);
    min-height: 100%;
    display: flex;
    flex-direction: column;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.container {
    max-width: var(--container-width);
    margin: 0 auto;
    padding: calc(var(--spacing-unit) * 4) calc(var(--spacing-unit) * 2.5);
    width: 100%;
    flex: 1;
}

header {
    text-align: center;
    margin-bottom: calc(var(--spacing-unit) * 6);
    padding-top: calc(var(--spacing-unit) * 3.5);
}

h1 {
    font-family: var(--font-heading);
    font-size: clamp(4rem, 6vw, 6.5rem);
    margin-bottom: calc(var(--spacing-unit) * 1.8);
    line-height: 1.15;
    font-weight: 700; 
    color: var(--color-primary);
    letter-spacing: -0.5px; 
    opacity:0;
    transform: translateY(-25px) scale(0.95);
    animation: title-swoop-in 0.9s cubic-bezier(0.165, 0.84, 0.44, 1) 0.1s forwards;
}
@keyframes title-swoop-in { to { opacity: 1; transform: translateY(0) scale(1); } }

.controls-panel {
    position: sticky;
    top: 0;
    z-index: 1000;
    background-color: transparent;
    padding: calc(var(--spacing-unit) * 1.8) 0;
    margin-bottom: calc(var(--spacing-unit) * 5);
    transition: padding var(--transition-smooth), background-color var(--transition-smooth), box-shadow var(--transition-smooth);
}
.controls-panel.scrolled {
    padding: calc(var(--spacing-unit) * 1.2) 0;
    background-color: rgba(var(--color-background-rgb-val, 253, 253, 253), 0.88); 
    backdrop-filter: blur(12px); 
    -webkit-backdrop-filter: blur(12px);
    box-shadow: 0 4px 30px rgba(0,0,0,0.08); 
}

.controls-wrapper {
    display: flex;
    gap: calc(var(--spacing-unit) * 1.8);
    align-items: center;
    max-width: 95rem; 
    margin: 0 auto;
    background-color: var(--color-surface);
    padding: calc(var(--spacing-unit) * 1); 
    border-radius: var(--radius-pill);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--color-border);
    transition: box-shadow var(--transition-smooth);
}
.controls-panel.scrolled .controls-wrapper {
     box-shadow: var(--shadow-sm);
}


.search-container { position: relative; flex-grow: 1; }
#search-input {
    width: 100%;
    padding: calc(var(--spacing-unit) * 1.8) calc(var(--spacing-unit) * 6) calc(var(--spacing-unit) * 1.8) calc(var(--spacing-unit) * 2.8); /* Adjusted padding */
    font-size: 1.7rem;
    border: none;
    border-radius: var(--radius-pill);
    background-color: var(--color-surface-alt);
    color: var(--color-text-base);
    transition: var(--transition-smooth);
    font-family: var(--font-body);
    font-weight: 500;
}
#search-input:focus {
    outline: none;
    box-shadow: 0 0 0 3.5px rgba(var(--color-primary-rgb), 0.35); 
    background-color: var(--color-surface);
}
#search-input::placeholder { color: var(--color-text-subtle); opacity: 1; }
.search-icon {
    position: absolute; top: 50%; right: calc(var(--spacing-unit) * 2.5);
    transform: translateY(-50%); color: var(--color-text-muted);
    pointer-events: none; width: 2.2rem; height: 2.2rem; opacity: 0.75;
}

.action-buttons-group { display: flex; align-items: center; gap: calc(var(--spacing-unit) * 1); }
.view-toggle-buttons, .theme-toggle-buttons, .experimental-link-group {
    display: flex;
    background-color: var(--color-surface-alt);
    border-radius: var(--radius-pill);
    padding: calc(var(--spacing-unit) * 0.5);
}
.view-toggle-buttons button, .theme-toggle-buttons button, .experimental-link-group a {
    background-color: transparent;
    color: var(--color-text-muted);
    border: none;
    padding: calc(var(--spacing-unit) * 1) calc(var(--spacing-unit) * 1.4);
    border-radius: var(--radius-pill);
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex; align-items: center; justify-content: center;
    width: 4.6rem; height: 4.6rem; 
    text-decoration: none;
    font-family: var(--font-body);
}
.experimental-link-group a { 
    width: 4.6rem; 
    height: 4.6rem;
    padding: calc(var(--spacing-unit) * 1); 
}
.experimental-link-group a svg {
    width: 2.2rem; height: 2.2rem; fill: currentColor;
}

.view-toggle-buttons button:hover, .theme-toggle-buttons button:hover, .experimental-link-group a:hover {
    color: var(--color-primary); background-color: var(--color-accent);
}
.view-toggle-buttons button.active, .theme-toggle-buttons button.active {
    background-image: linear-gradient(to right, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: var(--color-text-on-primary);
    box-shadow: var(--shadow-sm);
}
.view-toggle-buttons button svg, .theme-toggle-buttons button svg { width: 2.2rem; height: 2.2rem; fill: currentColor; }

#search-feedback-area {
    max-width: 95rem; margin: calc(var(--spacing-unit) * 1.8) auto 0 auto;
    min-height: calc(var(--spacing-unit) * 4.5); padding: 0 var(--spacing-unit);
}
#search-results, #did-you-mean-container {
    text-align: center; font-size: 1.65rem; color: var(--color-text-muted);
    font-weight: 500; padding: calc(var(--spacing-unit) * 0.6) 0; transition: opacity var(--transition-fast);
}
#did-you-mean-container .suggestion-link {
    color: var(--color-secondary); font-weight: 700; text-decoration: none;
    border-bottom: 2px solid var(--color-secondary); cursor: pointer; transition: var(--transition-fast);
    padding: 0.25rem 0.15rem;
}
#did-you-mean-container .suggestion-link:hover {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
    background-color: rgba(var(--color-primary-rgb), 0.05);
}

#toc { list-style-type: none; transition: var(--transition-smooth); }

#toc.list-view { display: flex; flex-direction: column; gap: calc(var(--spacing-unit) * 1.8); }
#toc.list-view li {
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-sm);
    transition: var(--transition-smooth);
    animation: item-slide-in-list 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    opacity: 0; animation-delay: calc(var(--i,0) * 0.03s);
    overflow: hidden;
}
#toc.list-view li:hover {
    transform: scale(1.018) translateX(-0.4rem);
    box-shadow: var(--shadow-lg);
    border-color: var(--color-border-light);
    border-left: 4px solid var(--color-primary);
}
#toc.list-view a {
    text-decoration: none; color: var(--color-text-base); display: flex;
    justify-content: space-between; align-items: center;
    padding: calc(var(--spacing-unit) * 2.4) calc(var(--spacing-unit) * 3);
}
#toc.list-view .title { font-weight: 500; font-size: 1.9rem; color: var(--color-text-base); transition: color var(--transition-fast);}
#toc.list-view .page-number {
    font-weight: 600; flex-shrink: 0;
    background-image: var(--page-num-gradient-list);
    color: var(--color-text-on-primary);
    padding: calc(var(--spacing-unit) * 1.1) calc(var(--spacing-unit) * 2.2);
    border-radius: var(--radius-pill); font-size: 1.5rem; transition: var(--transition-elastic);
    min-width: 6rem; text-align: center; box-shadow: var(--shadow-xs);
}
#toc.list-view li:hover .title { color: var(--color-primary); }
#toc.list-view li:hover .page-number { transform: scale(1.08) rotate(-3deg); box-shadow: var(--shadow-md); }

#toc.card-view {
    display: grid;
    gap: calc(var(--spacing-unit) * 3.5);
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 330px), 1fr));
}
#toc.card-view li {
    background-color: var(--color-surface);
    border-radius: var(--radius-xl);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-md);
    transition: var(--transition-smooth);
    overflow: hidden;
    display: flex; flex-direction: column;
    animation: item-zoom-in-card 0.55s cubic-bezier(0.165, 0.84, 0.44, 1.03) forwards;
    opacity: 0; animation-delay: calc(var(--i,0) * 0.04s);
}
#toc.card-view li:hover { transform: translateY(-1.2rem) scale(1.05); box-shadow: var(--shadow-lg); border-color: var(--color-border-light); }
#toc.card-view a {
    text-decoration: none; color: var(--color-text-base); display: flex; flex-direction: column;
    padding: calc(var(--spacing-unit) * 3.2); 
    flex-grow: 1;
}
#toc.card-view .title {
    font-family: var(--font-heading);
    font-weight: 600; font-size: 2.2rem; line-height: 1.35; color: var(--color-primary);
    margin-bottom: calc(var(--spacing-unit) * 2.8); flex-grow: 1;
}
#toc.card-view .page-number {
    font-weight: 700; align-self: flex-end;
    background-image: var(--page-num-gradient-card);
    color: var(--color-text-on-primary);
    padding: calc(var(--spacing-unit) * 1.3) calc(var(--spacing-unit) * 2.6);
    border-radius: var(--radius-pill); font-size: 1.6rem;
    box-shadow: 0 5px 15px rgba(var(--color-highlight-rgb),0.28);
    transition: var(--transition-elastic);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
#toc.card-view li:hover .page-number { transform: scale(1.15) rotate(7deg) translateY(-0.3rem); box-shadow: 0 7px 18px rgba(var(--color-highlight-rgb),0.38); }

@keyframes item-slide-in-list { from { opacity: 0; transform: translateX(30px) scale(0.97); } to { opacity: 1; transform: translateX(0) scale(1); } }
@keyframes item-zoom-in-card { from { opacity: 0; transform: scale(0.9) translateY(12px); } to { opacity: 1; transform: scale(1) translateY(0); } }

mark {
    background-color: var(--mark-bg); color: var(--mark-color); 
    padding: 0.3em 0.65em; border-radius: var(--radius-sm); font-weight: 600;
    box-shadow: 0 1px 3px rgba(var(--mark-color), 0.12);
}

.skip-link {
    position: absolute; top: -15rem; left: 1.8rem; background: var(--color-primary); color: var(--color-text-on-primary);
    padding: calc(var(--spacing-unit) * 1.3) calc(var(--spacing-unit) * 3); border-radius: var(--radius-md);
    transition: top 0.3s ease-in-out; z-index: 9999; font-weight: 700; font-size: 1.75rem; box-shadow: var(--shadow-md);
}
.skip-link:focus { top: var(--spacing-unit) * 1.8; }
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }


@media (max-width: 992px) {
    .controls-wrapper { flex-direction: column; border-radius: var(--radius-lg); padding: calc(var(--spacing-unit)*2); }
    .action-buttons-group { width: 100%; justify-content: space-around; margin-top: var(--spacing-unit) * 1.2; flex-wrap: wrap; }
    .experimental-link-group { margin-top: calc(var(--spacing-unit) * 1); }

}
@media (max-width: 768px) {
    html { font-size: 58%; }
    #toc.card-view { grid-template-columns: repeat(auto-fill, minmax(min(100%, 290px), 1fr)); }
}
@media (max-width: 480px) {
    html { font-size: 52%; }
    h1 { font-size: clamp(3.4rem, 5vw, 5.2rem); }
    #toc.card-view { grid-template-columns: 1fr; }
    .controls-wrapper { border-radius: var(--radius-md); }
    .view-toggle-buttons button, .theme-toggle-buttons button, .experimental-link-group a { padding: var(--spacing-unit) * 0.9; width: 4rem; height: 4rem;}
    .experimental-link-group a { width: 4rem; padding: calc(var(--spacing-unit) * 0.9); } /* Consistent padding for icon */
    .view-toggle-buttons button svg, .theme-toggle-buttons button svg, .experimental-link-group a svg { width: 2rem; height: 2rem;}
}

@media print {
    html[data-theme="dark"], html[data-theme="light"] {
        --color-primary: #000000; --color-secondary: #000000;
        --color-background: #ffffff; --color-surface: #ffffff;
        --color-text-base: #000000; --color-text-muted: #333333;
        --color-border: #cccccc; --color-border-light: #dddddd;
        --page-num-gradient-card: none;
        --page-num-gradient-list: none;
    }
    body { font-size: 11pt; background: #fff !important; color: #000 !important; -webkit-font-smoothing: auto; -moz-osx-font-smoothing: auto; }
    .container { max-width: 100%; padding: 0; }
    h1 { font-size: 20pt; color: #000 !important; }
    .controls-panel, .skip-link, #did-you-mean-container, .action-buttons-group { display: none !important; }
    #search-input { border: 1px solid #ccc !important; } .search-icon { display: none; }
    #toc { display: block !important; }
    #toc li {
        box-shadow: none !important; border: 1px solid #ccc !important; page-break-inside: avoid;
        margin-bottom: var(--spacing-unit); animation: none !important; opacity: 1 !important; transform: none !important;
        background-color: #fff !important;
    }
    #toc a { padding: 10pt !important; color: #000 !important; }
    #toc .page-number { background-image: none !important; background-color: #eee !important; color: #000 !important; padding: 5pt 10pt !important; box-shadow: none !important; border: 1px solid #ccc !important; }
    mark { background-color: yellow !important; color: #000 !important; }
}

@media (forced-colors: active) {
    :root {
        --color-primary: CanvasText; --color-secondary: CanvasText; --color-accent: Highlight;
        --color-background: Canvas; --color-surface: Canvas; --color-text-base: CanvasText;
        --color-border: CanvasText; --color-text-on-primary: HighlightText;
         --page-num-gradient-card: Highlight;
         --page-num-gradient-list: Highlight;
    }
    #toc li:hover { border-color: Highlight; }
    .page-number, mark, .view-toggle-buttons button.active, .theme-toggle-buttons button.active { background: Highlight !important; color: HighlightText !important; }
    h1 { color: CanvasText !important; }
    #search-input { border: 1px solid CanvasText; background-color: Canvas; color: CanvasText;}
    .controls-wrapper, .view-toggle-buttons, .theme-toggle-buttons, .experimental-link-group { background-color: Canvas; }
    .experimental-link-group a { color: LinkText; } /* Ensure link color is appropriate */
    .experimental-link-group a svg { fill: LinkText; } /* Match icon to link text */
}

@media (prefers-reduced-motion: reduce) {
    *, ::before, ::after {
        animation-duration: 0.001s !important; animation-iteration-count: 1 !important;
        transition-duration: 0.001s !important; scroll-behavior: auto !important;
        animation-delay: 0s !important;
    }
}
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">تخطي إلى المحتوى الرئيسي</a>
    <div class="container">
        <header>
            <h1>بروتوكولات التأمين</h1>
        </header>
        
        <div class="controls-panel" id="controls-panel-id">
            <div class="controls-wrapper">
                <div class="search-container">
                    <label for="search-input" class="sr-only">بحث في الفهرس</label>
                    <input type="search" id="search-input" placeholder="ابحث بالاسم أو رقم الصفحة..." aria-label="بحث في الفهرس">
                    <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
                </div>
                <div class="action-buttons-group">
                    <div class="view-toggle-buttons">
                        <button id="card-view-btn" aria-label="عرض كبطاقات">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z"></path></svg>
                        </button>
                        <button id="list-view-btn" aria-label="عرض كقائمة">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 15h18v-2H3v2zm0 4h18v-2H3v2zm0-8h18V9H3v2zm0-6v2h18V5H3z"></path></svg>
                        </button>
                    </div>
                    <div class="theme-toggle-buttons">
                        <button id="theme-toggle-btn" aria-label="تبديل المظهر">
                            <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L5.64 5.64zm12.73 12.73c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.06-1.06zM12 3c-.55 0-1 .45-1 1v.01c0 .55.45 1 1 1s1-.45 1-1V4c0-.55-.45-1-1-1zm0 16c-.55 0-1 .45-1 1v.01c0 .55.45 1 1 1s1-.45 1-1V20c0-.55-.45-1-1-1zM4.22 18.36l1.06-1.06c.39-.39.39-1.02 0-1.41s-1.02-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.03.39 1.41 0zM18.36 4.22l1.06-1.06c.39-.39.39-1.02 0-1.41a.9959.9959 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.03.39 1.41 0z"></path></svg>
                            <svg class="moon-icon" style="display:none;" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg>
                        </button>
                    </div>
                    <div class="experimental-link-group">
                         <a href="https://experimental-alpha.vercel.app/" id="experimental-link" target="_blank" rel="noopener noreferrer" aria-label="رابط تجريبي">
                            <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19.25,15.25c0-1.04-.36-2.02-.98-2.83L15.46,8H14V5c0-.55-.45-1-1-1H9C8.45,4,8,4.45,8,5v3H7.54l-2.81,4.42 C4.11,13.23,3.75,14.21,3.75,15.25V18c0,.55,.45,1,1,1h13.5c.55,0,1-.45,1-1v-2.75ZM6.28,13h11.44l1.44-2.25L18,9.07V9h-2.04 L14.5,11h-5L8.04,9H6l-.72,1.75L6.28,13Zm.22,4V15h11v2H6.5ZM10,6h2v2h-2V6Z"/>
                            </svg>
                         </a>
                    </div>
                </div>
            </div>
            <div id="search-feedback-area">
                <div id="search-results" aria-live="polite"></div>
                <div id="did-you-mean-container" aria-live="polite"></div>
            </div>
        </div>

        <main id="main-content">
            <nav aria-label="الفهرس">
                <ul id="toc"></ul>
            </nav>
        </main>
    </div>

    <script>
        const tocItems = [
            { title: 'المقدمة', page: 1 }, { title: 'انظمة الانتفاع بالخدمات التأمينية', page: 2 },
            { title: 'القوانين واللوائح (القرارات) المنظمة للتعامل مع أدوية الهيئة العامة للتأمين الصحي', page: 3 },
            { title: 'امثلة للمخالفات التي تندرج تحت طائلة قانون 10 سنة 67', page: 4 }, { title: 'اوامر ادارية', page: 5 },
            { title: 'تعليمات عامة للسادة الأطباء والصيادلة مستخدمي التذاكر الطبية', page: 6 },
            { title: 'الإجراءات التي تتبع عند استلام وإرجاع التذاكر الطبية', page: 7 },
            { title: 'الإجراءات التي تتبع في حالة فقد دفتر التذاكر الطبية', page: 10 },
            { title: 'اجراءات التعامل مع المنتفع في تحرير وصرف التذاكر الطبية', page: 11 }, { title: 'وصف الدواء', page: 15 },
            { title: 'الأمراض المزمنة', page: 17 }, { title: 'تعليمات عامة للصيادلة', page: 21 },
            { title: 'الأخطاء الممكن حدوثها من بعض الأطباء والصيادلة وما يقابلها من المراجعة الفنية', page: 24 },
            { title: 'إرشادات عامة للصيدليات المتعاقدة', page: 27 }, { title: 'احكام عامة', page: 32 },
            { title: 'لائحة المخالفات والجزاءات للصيدليات المتعاقدة', page: 34 }, { title: 'آلية صرف أدوية الاسم التجاري', page: 36 },
            { title: 'آلية التعامل مع اللجنة العليا للدواء', page: 37 }, { title: 'البروتوكولات المنظمة لصرف الأدوية', page: 40 },
            { title: 'أدوية الأورام', page: 41 }, { title: 'أدوية الاوعية الدموية', page: 67 }, { title: 'أدوية الصرع', page: 69 },
            { title: 'البروتوكول العلاجي لمرضى السكر', page: 70 }, { title: 'ضوابط استخدام مثبطات المناعة بعد زرع الكلى', page: 75 },
            { title: 'Alpha Calcidol ضوابط صرف', page: 76 }, { title: 'بروتوكول عقار الإريثروبيوتين', page: 77 },
            { title: 'Gilenya ضوابط صرف', page: 80 }, { title: 'IVIG ضوابط صرف', page: 81 },
            { title: 'ضوابط استخدام الألبيومين البشري', page: 83 },
            { title: 'ضوابط استخدام الأدوية المسيلة للدم أثناء الحمل في وجود تغيير صمامات القلب', page: 85 },
            { title: 'ضوابط صرف أدوية الهيبارين منخفض الوزن الجزيئي', page: 86 }, { title: 'LHRH Analogue ضوابط صرف', page: 87 },
            { title: 'Growth hormone ضوابط صرف', page: 88 }, { title: 'أدوية الكبد', page: 91 },
            { title: 'أدوية أمراض الدم', page: 101 }, { title: 'ضوابط صرف أدوية المضادات الحيوية', page: 114 },
            { title: 'أدوية الرمد', page: 118 }, { title: 'أدوية هشاشة العظام', page: 121 },
            { title: 'ضوابط صرف المخدرات', page: 123 },
            { title: 'التعليمات المنظمة لصرف الفلانشات والشرابات الطبية', page: 126 }, { title: 'الفهرس', page: 127 }
        ];

        const tocElement = document.getElementById('toc');
        const searchInput = document.getElementById('search-input');
        const resultsElement = document.getElementById('search-results');
        const didYouMeanContainer = document.getElementById('did-you-mean-container');
        const cardViewBtn = document.getElementById('card-view-btn');
        const listViewBtn = document.getElementById('list-view-btn');
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const sunIcon = themeToggleBtn.querySelector('.sun-icon');
        const moonIcon = themeToggleBtn.querySelector('.moon-icon');
        const controlsPanel = document.getElementById('controls-panel-id');
        const htmlElement = document.documentElement;

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function levenshteinDistance(a, b) {
            if (a.length === 0) return b.length;
            if (b.length === 0) return a.length;
            const matrix = Array(a.length + 1).fill(null).map(() => Array(b.length + 1).fill(null));
            for (let i = 0; i <= a.length; i += 1) matrix[i][0] = i;
            for (let j = 0; j <= b.length; j += 1) matrix[0][j] = j;
            for (let j = 1; j <= b.length; j += 1) {
                for (let i = 1; i <= a.length; i += 1) {
                    const indicator = a[i - 1] === b[j - 1] ? 0 : 1;
                    matrix[i][j] = Math.min(matrix[i - 1][j] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j - 1] + indicator);
                }
            }
            return matrix[a.length][b.length];
        }
        
        function createTOCItem(item, index) {
            const li = document.createElement('li');
            li.style.setProperty('--i', index);
            const a = document.createElement('a');
            a.href = `https://online.fliphtml5.com/ycdxn/moun/#p=${item.page}`;
            a.target = "_blank";
            a.rel = "noopener noreferrer";
            a.setAttribute('aria-label', `${item.title} - الصفحة ${item.page}`);
            a.innerHTML = `<span class="title">${item.title}</span><span class="page-number">${item.page}</span>`;
            li.appendChild(a);
            return li;
        }

        function renderTOC(itemsToRender = tocItems) {
            if (!tocElement) return;
            const fragment = document.createDocumentFragment();
            itemsToRender.forEach((item, index) => {
                fragment.appendChild(createTOCItem(item, index));
            });
            tocElement.innerHTML = '';
            tocElement.appendChild(fragment);
        }

        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            const escapedSearchTerm = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedSearchTerm})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        function filterAndRenderTOC() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            didYouMeanContainer.innerHTML = '';
            let visibleCount = 0;

            const filteredItems = tocItems.map(item => {
                const titleMatch = item.title.toLowerCase().includes(searchTerm);
                const pageMatch = item.page.toString().includes(searchTerm);
                return { ...item, isVisible: searchTerm === '' || titleMatch || pageMatch };
            });

            tocElement.innerHTML = '';
            const fragment = document.createDocumentFragment();
            filteredItems.forEach((item, index) => {
                const li = createTOCItem(item,index);
                const titleElement = li.querySelector('.title');
                if (item.isVisible) {
                    titleElement.innerHTML = highlightText(item.title, searchTerm);
                    fragment.appendChild(li);
                    visibleCount++;
                }
            });
            tocElement.appendChild(fragment);

            if (searchTerm === '') {
                resultsElement.textContent = '';
            } else {
                resultsElement.textContent = `تم العثور على ${visibleCount} ${visibleCount === 1 ? 'نتيجة' : 'نتائج'}`;
                if (visibleCount === 0 && searchTerm.length > 1) {
                    showSuggestions(searchTerm);
                }
            }
        }
        
        function showSuggestions(searchTerm) {
            const suggestions = tocItems.map(item => ({ title: item.title, distance: levenshteinDistance(searchTerm, item.title.toLowerCase()) }))
                .filter(item => item.distance <= Math.max(1, Math.floor(item.title.length / 3.0)) && item.distance < searchTerm.length ) 
                .sort((a, b) => a.distance - b.distance).slice(0, 1);

            if (suggestions.length > 0) {
                const bestSuggestion = suggestions[0].title;
                didYouMeanContainer.innerHTML = `هل تقصد: <span class="suggestion-link" role="button" tabindex="0">${bestSuggestion}</span>؟`;
                didYouMeanContainer.querySelector('.suggestion-link').onclick = () => {
                    searchInput.value = bestSuggestion;
                    filterAndRenderTOC();
                    searchInput.focus();
                };
            } else {
                didYouMeanContainer.innerHTML = '';
            }
        }

        function setView(view) {
            if (view === 'card') {
                tocElement.classList.remove('list-view');
                tocElement.classList.add('card-view');
                cardViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
            } else {
                tocElement.classList.remove('card-view');
                tocElement.classList.add('list-view');
                listViewBtn.classList.add('active');
                cardViewBtn.classList.remove('active');
            }
            localStorage.setItem('tocView', view);
            filterAndRenderTOC(); 
        }

        function applyTheme(theme) {
            htmlElement.setAttribute('data-theme', theme);
            localStorage.setItem('themePreference', theme);
            
            const isDark = theme === 'dark';
            sunIcon.style.display = isDark ? 'block' : 'none';
            moonIcon.style.display = isDark ? 'none' : 'block';
            themeToggleBtn.setAttribute('aria-label', isDark ? 'تفعيل المظهر الفاتح' : 'تفعيل المظهر الداكن');

            // Update --color-background-rgb-val for the scrolled controls panel
            const bgRgbVal = getComputedStyle(htmlElement).getPropertyValue('--color-background-rgb').trim();
            if (bgRgbVal) {
                htmlElement.style.setProperty('--color-background-rgb-val', bgRgbVal);
            } else { 
                 htmlElement.style.setProperty('--color-background-rgb-val', isDark ? '26, 29, 36' : '253, 253, 253');
            }
        }

        function toggleTheme() {
            const currentTheme = htmlElement.getAttribute('data-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
        }
        
        function initializeTheme() {
            const storedTheme = localStorage.getItem('themePreference');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (storedTheme) {
                applyTheme(storedTheme);
            } else {
                applyTheme(systemPrefersDark ? 'dark' : 'light');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                const currentSetTheme = localStorage.getItem('themePreference');
                if (!currentSetTheme) { 
                    applyTheme(e.matches ? 'dark' : 'light');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            renderTOC(); 
            
            if (searchInput) {
                searchInput.addEventListener('input', debounce(filterAndRenderTOC, 250));
            }

            if (controlsPanel) {
                const handleScroll = () => { controlsPanel.classList.toggle('scrolled', window.pageYOffset > 30); };
                window.addEventListener('scroll', debounce(handleScroll, 50));
                handleScroll(); 
            }

            cardViewBtn.addEventListener('click', () => setView('card'));
            listViewBtn.addEventListener('click', () => setView('list'));
            themeToggleBtn.addEventListener('click', toggleTheme);

            const preferredView = localStorage.getItem('tocView') || 'card';
            setView(preferredView);
        });
    </script>
</body>
</html>
